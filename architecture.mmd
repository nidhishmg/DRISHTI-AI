flowchart TD
    subgraph Client_Layer
        Web["Next.js Frontend\n(Dashboard, Map, Graph)"]
        Mobile["Citizen Mobile App\n(WhatsApp/Voice)"]
    end
    
    subgraph API_Layer
        Gateway["FastAPI Gateway\n(Auth, Rate Limit)"]
        Web -->|HTTP/REST| Gateway
        Mobile -->|Voice/Text| Gateway
    end

    subgraph Sources
        YT[YouTube Scraper]
        TW[Twitter Scraper]
        News[News Scraper]
    end
    Sources --> Gateway

    subgraph Service_Layer
        Worker[Ingestion Worker]
        Dedup[Fingerprint Service]
        Causal[Causal Engine]
    end
    
    Gateway -->|Async Tasks| Worker
    Worker --> Dedup
    Worker --> Causal

    subgraph Storage_Layer
        PG[(PostgreSQL)]
        Milvus[(Milvus Vector DB)]
        Neo4j[(Neo4j Graph)]
        MinIO[(MinIO Object Store)]
        Redis[(Redis Queue)]
    end
    
    Gateway --> Redis
    Worker <--> PG
    Worker <--> Milvus
    Worker <--> Neo4j
    Worker <--> MinIO
    Causal <--> Neo4j

    subgraph Observability
        Prom[Prometheus]
        Graf[Grafana]
        Prom --> Graf
        Worker -.-> Prom
        Gateway -.-> Prom
    end
